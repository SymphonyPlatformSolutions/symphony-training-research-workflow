id: research-webhook-workflow

variables:
  approvalRoomId: vejDKVdkDOwkhI85VgLku3///oKu0qZFdA==
  botRoomId: d0KJuWpuCuwJiTxnKjcvV3///oMalfRAdA==

activities:
  - send-message:
      id: authoringWebhookForm
      on:
        one-of:
          - message-received:
              content: /research
          - request-received:
              token: my-secret-token
      to:
        stream-id: ${variables.botRoomId}
      content: |
        <form id="authoringWebhookForm">
          <h2>Research Webhook Authoring Form</h2>
          <hr/>
          <text-field name="webhookTicker" label="Ticker">${event.args.webhookTicker}</text-field>
          <textarea name="webhookContent" label="Research Content">${event.args.webhookContent}</textarea>
          <hr/>
          <button name="submit">Submit for Approval</button>
        </form>

  - execute-script:
      id: prepareWebhookApprovalForm
      script: |
        variables.webhookTicker = event.args.webhookTicker
        variables.webhookContent = event.args.webhookContent

  - send-message:
      id: approvalWebhookForm
      on:
        form-replied:
          form-id: authoringWebhookForm
      to:
        stream-id: ${variables.approvalRoomId}
      content:
        <form id="approvalWebhookForm">
        <h2>Research Webhook Approval Form</h2>
        <hr/>
        Ticker - ${variables.webhookTicker} <br/> Content - ${variables.webhookContent}
        <hr/>
        <button name="approve" type="action">Approve</button>
        <button name="reject" type="action">Reject</button>
        </form>
